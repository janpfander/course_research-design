{
  "hash": "4ca9ea3201457585261e5973b7a0a54b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"RCTs and Validity\"\nformat: \n  revealjs:\n    theme: simple\n    smaller: true\n    slide-number: true\n    # incremental: true\n    # code-link: true\n    chalkboard: true\n    history: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(kableExtra)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'kableExtra'\n\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(truncnorm)\nlibrary(broom)\n```\n:::\n\n\n\n\n\n\n## Overview\n\n::::: columns\n::: {.column style=\"font-size: smaller;\"}\n1.  **The magic of randomization**\n\n2. **How to analyze RCTs**\n\n3.  **Validity**\n\n:::\n\n::: {.column style=\"font-size: smaller;\"}\n\n:::\n:::::\n\n# The magic of randomization\n\n---\n\n## Fundamental problem of causal inference\n\n- Imagine we want to know if a treatment helps in quicker recovery of disease\n\n- Imagine there is only one patient, Angela\n\n- We could give Angela the treatment and see how quickly she gets better.\n\n- Or we could not give her the treatment and see how quickly she gets better.\n\n---\n\n## Fundamental problem of causal inference\n\n- In either case, we’d want to know “What if… \n\n- \"What if we had/had not given her the treatment”\n\n- This is also called a **counterfactual** - counter to the fact of what actually happened.\n\n---\n\n## Solution: randomization and averages\n\n- Instead of only one patient, we need to look at several patients\n\n- If we randomly assign patients to a treatment and a control condition...\n\n- And if the sample is big enough...\n\n- Then people in these groups are on average the same on all imaginable variables (e.g. age, sex, income)\n\n- That's the magic of randomization\n\n---\n\n## Randomized Controlled Trials (RCTs)\n\n![](images/wb-4-1.png){width=\"80%\"}\n\n# How to analyze RCTs\n\n---\n\n## Analyzing RCTs is very easy\n\n<br>\n\nStep 1: Check that key variables are balanced between control and treatment group\n\n(this is something we'd expect from randomization, but with small samples you might get unlucky)\n\n<br>\n\nStep 2: Find difference in average outcome in treatment and control groups\n\n---\n\n## Example RCT\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimaginary_rct \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 800 × 6\n   person treatment   age sex    recovery_time male_num\n    <int> <chr>     <dbl> <chr>          <dbl>    <dbl>\n 1      1 Treatment    23 Female         3.94         0\n 2      2 Treatment    38 Male           4.84         1\n 3      3 Treatment    46 Female        -2.07         0\n 4      4 Treatment    12 Female         5.35         0\n 5      5 Treatment    39 Male           3.04         1\n 6      6 Treatment    40 Male           2.46         1\n 7      7 Treatment    29 Female         6.32         0\n 8      8 Treatment    30 Male           7.44         1\n 9      9 Treatment    29 Female        -0.442        0\n10     10 Treatment    26 Female         6.03         0\n# ℹ 790 more rows\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n## 1. Check balance\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimaginary_rct %>% \n  group_by(treatment) %>% \n  summarize(avg_age = mean(age),\n            prop_male = mean(sex == \"Male\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  treatment avg_age prop_male\n  <chr>       <dbl>     <dbl>\n1 Control      35.3      0.52\n2 Treatment    35.1      0.52\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n## 2. Calculate difference\n\n::::: columns\n::: {.column}\n\n**Group means**\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimaginary_rct %>% \n  group_by(treatment) %>% \n  summarize(avg_outcome = round(mean(recovery_time), digits = 2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  treatment avg_outcome\n  <chr>           <dbl>\n1 Control          6.04\n2 Treatment        2.9 \n```\n\n\n:::\n\n```{.r .cell-code}\n2.90 - 6.04\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -3.14\n```\n\n\n:::\n:::\n\n\n\n\n\n\n:::\n\n::: {.column}\n\n**Regression**\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrct_model <- lm(recovery_time ~ treatment, \n                data = imaginary_rct)\n\ntidy(rct_model) |> \n  select(estimate, statistic, p.value)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  estimate statistic   p.value\n     <dbl>     <dbl>     <dbl>\n1     6.04      40.4 6.84e-195\n2    -3.15     -14.9 2.84e- 44\n```\n\n\n:::\n:::\n\n\n\n\n\n:::\n\n:::::\n\n---\n\n## Your turn: Analyzing an RCT\n\nImagine an NGO is planning on launching a training program designed to boost incomes. \n\nThey ran a study on 1,000 participants over the course of 6 months and you just got your data back.\n\n1. Download and read the data set (either here: [{{< fa table >}} `village_randomized.csv`](../data/village_randomized.csv), or from this week's content on the course website)\n\n2. Before calculating the effect of the program, first check how well balanced the random assignment was.\n\n3. Estimate the treatment effect. This is simply the average outcome for people in the program minus the average outcome for people not in the program. \n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountdown::countdown(\n  minutes = 15,\n  bottom = 0, \n  right = 0,\n  # Fanfare when it's over\n  play_sound = FALSE,\n  color_border              = \"#FFFFFF\",\n  color_text                = \"#7aa81e\",\n  color_running_background  = \"#7aa81e\",\n  color_running_text        = \"#FFFFFF\",\n  color_finished_background = \"#ffa07a\",\n  color_finished_text       = \"#FFFFFF\",\n  font_size = \"1em\",\n  start_immediately = TRUE\n  )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_71840478\" data-update-every=\"1\" data-start-immediately=\"true\" tabindex=\"0\" style=\"right:0;bottom:0;font-size:1em;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">15</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n\n\n\n\n---\n\n## Solution \n\n1. Download and read the data set\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read data\nvillage_randomized <- read_csv(\"data/village_randomized.csv\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 1000 Columns: 8\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (2): sex, program\ndbl (6): id, age, pre_income, post_income, sex_num, program_num\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n## Solution \n\n2. Before calculating the effect of the program, first check how well balanced the random assignment was.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvillage_randomized |>\n  group_by(program) |>\n  summarize(\n    n = n(),\n    prop_male = mean(sex_num),\n    avg_age = mean(age),\n    avg_pre_income = mean(pre_income)\n    ) |> \n  # this rounds all numeric variables in the data frame to two digits\n  mutate_if(is.numeric, ~ round(.x, digits = 2)) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 5\n  program        n prop_male avg_age avg_pre_income\n  <chr>      <dbl>     <dbl>   <dbl>          <dbl>\n1 No program   503      0.58    34.9           803.\n2 Program      497      0.6     34.9           801.\n```\n\n\n:::\n:::\n\n\n\n\n\n\n---\n\n## Solution \n\n3. Estimate the treatment effect. This is simply the average outcome for people in the program minus the average outcome for people not in the program. \n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# for descriptive findings\nvillage_randomized |>\n  group_by(program) |>\n  summarize(avg_post = mean(post_income))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  program    avg_post\n  <chr>         <dbl>\n1 No program    1180.\n2 Program       1279.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# as a regression\nmodel_rct <- lm(post_income ~ program, data = village_randomized)\ntidy(model_rct)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 5\n  term           estimate std.error statistic  p.value\n  <chr>             <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)      1180.       4.27     276.  0       \n2 programProgram     99.2      6.06      16.4 1.26e-53\n```\n\n\n:::\n:::\n\n\n\n\n\n\n# Validity\n\n---\n\n## There are many different threats to validity\n\nThe overarching question is always the same: \n\n<br>\n\nCan we draw valid conclusions about our research question from the data we have?\n\n---\n\n## External vs. internal validity\n\n![](images/wb-4-4.png){width=\"80%\"}\n\n---\n\n## Internal validity\n\n\"How well does our research design in identify the (causal) effect we are looking for?\"\n\n<br>\n\nRCTs allows us to establish (valid) causality, but it is not immune to everything...\n\n  - (Self-)selection\n  - Attrition\n  - Hawthorne\n  - John Henry\n  - Spillovers\n  - Intervening events\n  \n---\n  \n## Self-selection\n  \n- If people can choose to enroll in a program, those who enroll will be different from those who do not\n\n<br>\n\nHow to fix it? \n\n- Make sure randomization is happening correctly\n\n---\n\n## Attrition\n\nIf the people who leave a program or study are different than those who stay, the effects will be biased\n\n<br>\n\nHow to fix it? \n\n- Check characteristics of those who stay and those who leave\n\n---\n\n## Hawthorne effect\n\nObserving people makes them behave differently\n\n<br>\n\nHow to fix it? \n\n- Hide? A tough fix...\n\n---\n\n## John Henry effect\n\nControl group works hard to prove they're as good as the treatment group\n\n<br>\n\nHow to fix it? \n\n- Keep two groups separate\n\n---\n\n## Spillover effects\n\nControl groups are sometimes naturally affected by what the treatment group is getting\n\ne.g. vaccine distribution in global south \n\n<br>\n\nHow to fix it? \n\n- Keep two groups separate; use distant control groups\n\n---\n\n## External validity\n\n\"Are our findings generalizable to the population we care about?\"\n\n<br>\n\n::::: columns\n::: {.column}\n\n![](images/external-validity1.png){width=\"80%\"}\n\n:::\n\n::: {.column}\n\n![](images/external-validity2.png){width=\"70%\"}\n\n:::\n\n:::::\n\n---\n\n## Lab conditions vs. real world\n\n- Most study volunteers are weird\n\n- **W**estern, **e**ducated, from **i**ndustrialized. **r**ich, and **d**emocratic countries\n\n---\n\n## Validity wrap-up\n\n- RCTs are also vulnerable to some threats of internal validity\n\n- RCTs **definitely don't** magically fix external validity\n\n---\n\nThat's it for today :)\n\n\n\n",
    "supporting": [
      "09-slides_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}