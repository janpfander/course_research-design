{
  "hash": "64f7619015e9c57d50ae4a6365f7274a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Problem set 4\"\nauthor: \"Put your name here\"\nformat: \n  html:\n    toc: true\n  pdf:\n    toc: true\n  docx:\n    toc: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234) # For reproducibility\n```\n:::\n\n\n\n\n\n\n\n\nRead the survey data.\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the survey data from class\nsurvey <- read_csv(\"../data/distance-to-school_pet-preferences.csv\")\n```\n:::\n\n\n\n\n\n\n\n\nIn this solution, we'll use simulated data.\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# simulate survey data\nsample_size <- 30\n\nsurvey <- tibble(\n  name = 1:sample_size,\n  distance = round(runif(sample_size, min = 0.3, max = 20), 1),\n  pet_preference = sample(c(\"dogs\", \"cats\"), size = sample_size, replace = TRUE)\n)\n```\n:::\n\n\n\n\n\n\n\n\n\n**Step 1: Calculate an estimate based on your sample**\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# compute rating difference in the sample\nsurvey_estimate <- survey |> \n  group_by(pet_preference) |> \n  summarize(avg_distance = mean(distance)) |> \n  summarise(diff = avg_distance[pet_preference == \"dogs\"] - avg_distance[pet_preference == \"cats\"]) %>%\n  pull(diff)\n\nsurvey_estimate\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -0.6533333\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nIn our sample, cat people live further away, on average.\n\n**Step 2: Use simulation to invent a world where the true effect is null.**\n\nSimulate a population, say all students in Paris, i.e. 700'000 students. \n  \n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# simulate survey data\npopulation_size <- 700000\n\npopulation <- tibble(\n  name = 1:population_size,\n  distance = round(runif(population_size, min = 0.3, max = 20), 1),\n  pet_preference = sample(c(\"dogs\", \"cats\"), size = population_size, replace = TRUE)\n)\n```\n:::\n\n\n\n\n\n\n\n  \n  \n  Simulate 1000 samples with the same sample size that your estimate is based on. Store the estimates of this simulation in a vector called `sampling_distribution`.\n  \n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn_simulations <- 1000\nsample_size <- 30\ndifferences <- c() # make an empty vector\n\nfor (i in 1:n_simulations) {\n  # draw a sample of 20'000 films\n  sample <- population |> \n    sample_n(sample_size)\n  # compute rating difference in the sample\n  estimate <- sample |> \n    group_by(pet_preference) |> \n    summarize(avg_distance = mean(distance)) |> \n    summarise(diff = avg_distance[pet_preference == \"dogs\"] - avg_distance[pet_preference == \"cats\"]) %>%\n    pull(diff)\n  \n  differences[i] <- estimate\n}\n```\n:::\n\n\n\n\n\n\n\n  \n**Step 3: Plot how well this estimate fits into your null world.**  \n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data.frame(differences), aes(x = differences)) +\n  geom_histogram() +\n  geom_vline(xintercept = survey_estimate, color = \"red\", size = 1, linetype = \"dashed\") +\n  labs(title = \"Sampling distribution based on simulated data\",\n       x = \"Distance to school\",\n       y = \"Frequency\") +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](04-solution_files/figure-docx/unnamed-chunk-8-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n\n**Step 4: Calculate the probability that your estimate could exist in the null world.**  \n  \nUse the standard deviation of your `sampling_distribution` to transform your initial estimate in a z-value. \n  \n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsd_sampling_distribution <- sd(differences)\n\nz_scaled_estimate = survey_estimate / sd_sampling_distribution\n\nz_scaled_estimate\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -0.3074499\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nBased on this, calculate the p-value.\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# the pnorm() function gives the cumulative probability from the standard normal distribution \n\n# Two-tailed (i.e. a value \"at least as extreme as\", in both directions)\nprobability <- 2 * (1 - pnorm(z_scaled_estimate)) \n\n# in our case, the probability is reeaally low (practically 0)\nprobability\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.241499\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n  \n**Step 5: Decide if your estimate is statistically significant.**  \n\nUse a significance threshold (the value at which you consider your estimate sufficiently unlikely to have occurred in the Null World) of 0.05\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# significance levels are often called \"alpha\"\nalpha <- 0.05\n\nprobability < alpha\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nNo, our estimate is not statistically significant: We cannot cannot reject the Null hypothesis that in fact, in the population, there is no true effect. In other words, in a world where there is no effect, it does not appear sufficiently unlikely to randomly sample an estimate at least as big as the one we found.\n\n4. Is this result surprising to you or not? Explain.\n\nThis result is probably not surprising, since we would hardly expect a relationship between pet preferences and distance to school a priori. \n\n",
    "supporting": [
      "04-solution_files/figure-docx"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}